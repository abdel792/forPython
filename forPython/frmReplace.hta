<HTML>
	<HEAD> 
		<TITLE>Rechercher et remplacer avancé</TITLE>
		<HTA:APPLICATION ID='Document1' APPLICATIONNAME='Document1' CAPTION='yes' CONTEXTMENU='yes' MAXIMIZEBUTTON='yes' MINIMIZEBUTTON='yes' NAVIGABLE='yes' SELECTION='yes' SHOWINTASKBAR='yes' SYSMENU='yes' WindowState='normal' >

			<script language="VBScript">

			Sub Window_onLoad
' au chargement de la fenêtre
on error resume next
if 1 = 0 then
' importation des paramètres anciens sauvegardés par le fichier intermédiaire
s= vbcrlf & readFile(getIniFile) & vbcrlf
tbl = split(s, vbcrlf)
for i = 0 to ubound(tbl)
if inStr(tbl(i), "textToReplace=") > 0 then
document.form1.textToReplace.value = mid(tbl(i), len("textToReplace=")+1)
elseif inStr(tbl(i), "replaceBy=") > 0 then
document.form1.replaceBy.value = mid(tbl(i), len("replaceBy=")+1)
elseif inStr(tbl(i), "searchType=") > 0 then
v=mid(tbl(i), len("searchType=")+1)
if v <> "" and v <> "0" then document.form1.searchType.value = v
elseif inStr(tbl(i), "searchDirection=") > 0 then
v=mid(tbl(i), len("searchDirection=")+1)
if v <> "" and v <> "0" then document.form1.searchDirection.value = v
elseif inStr(tbl(i), "searchZone=") > 0 then
v = mid(tbl(i), len("searchZone=")+1)
if v <> "" and v <> "0" then document.form1.searchZone.value = v
elseif inStr(tbl(i), "respectCase=") > 0 then
document.form1.respectCase.checked= CLng(mid(tbl(i), len("searchZone=")+1))
elseif inStr(tbl(i), "allWordOnly=") > 0 then
document.form1.allWordOnly.checked= CLng(mid(tbl(i), len("allWordOnly=")+1))
end if
next
end if
' réinitialisation du fichier intermédiaire
writeFile getIniFile, "", true
' positionnement du focus
document.form1.textToReplace.focus()
			End Sub

sub form1_validate()
' à la validation du formulaire
' on va généré le texte à écrire dans le fichier ini intermédiaire
dim s: s = ""
dim v: v = ""
on error resume next

' le texte à remplacer
v = document.form1.textToReplace.value
if v = "" then
MsgBox "Vous devez obligatoirement taper le texte à remplacer avant d'effectuer cette action.", vbOKOnly+vbExclamation, "Erreur- texte à remplacer" 
document.form1.textToReplace.focus()
exit sub
end if
s = s & "textToReplace=" & v & vbcrlf

' le texte de remplacement
v = document.form1.replaceBy.value
s = s & "replaceBy=" & v & vbcrlf

' le type de recherche
v = document.form1.searchType.value
s = s & "searchType=" & v & vbcrlf

' la direction de la recherche
v = document.form1.searchDirection.value
s = s & "searchDirection=" & v & vbcrlf

' la zone de la recherche
v = document.form1.searchZone.value
s = s & "searchZone=" & v & vbcrlf

' respect de la cass ?
v = abs(document.form1.respectCase.checked)
s = s & "respectCase=" & v & vbcrlf

' Mot entier uniquement ?
v = abs(document.form1.allWordOnly.checked)
s = s & "allWordOnly=" & v & vbcrlf

' écriture dans le fichier ini intermédiaire
writeFile getIniFile, s, true
window.close
end sub

sub form1_cancel()
' bouton annuler
' msgbox sKey
window.close
End sub

function getIniFile()
' trouve le chemin vers le fichier ini intermédiaire
sPathIni = document.location.pathname
tbl = split(sPathIni, "\")
redim preserve tbl(ubound(tbl)-1)
sPathIni = join(tbl, "\")
sPathIni = sPathIni & "\" & "com.ini"
getIniFile = sPathIni
end function

function readFile(sPath)
' lit et renvoi le contenu d'un fichier
s=""
on error resume next
set fso=CreateObject("Scripting.FileSystemObject")
set fichier=fso.GetFile(sPath)
set ts=fichier.OpenAsTextStream
' ForReading
s=ts.ReadAll
ts.Close
set ts=nothing
set fichier=nothing
set fso=nothing
readFile = s
end function

Function WriteFile (sFilePath, sText, BlErase)
'' écriture dans un fichier
on error resume next
set fs = CreateObject("Scripting.FileSystemObject")
'
' si on doit écraser ou pas
if BlErase = true then
Set FSStream = fs.CreateTextFile(sFilePath, True)
FSStream.Write (sText) 
FSStream.Close
else ' il s'agit d'un ajout au fichier
Set f = FS.GetFile(sFilePath)
Set FSStream = f.OpenAsTextStream(8)
FSStream.WriteLine sText
FSStream.Close
end if ' fin si BlErase
Set FSStream = Nothing
set f = nothing
set FS = Nothing
End Function


function FormatResult(s)
'
dim s2: s2 = ""
dim reg
set reg = CreateObject("vbscript.regexp")
reg.Global = true
reg.IgnoreCase = true
reg.Multiline = false
reg.Pattern = "[^\r\n]+"
set found = reg.Execute(s)
if found.count > 0 then
for i = 0 to found.count-1
if i > 0 then s2 = s2 & ",,,"
s2 = s2 & found(i).value
next
end if
set found = nothing
set reg = nothing
' renvoi
FormatResult = s2
end function

		</script>
	</HEAD>
	<BODY>

<form name="form1" onSubmit="form1_validate">

<label for="textToReplace">Texte à remplacer:</label>
<input type="text" name="textToReplace" id="textToReplace">

<br />

<label for="replaceBy">Remplacer par:</label>
<input type="text" name="replaceBy" id="replaceBy">

<br />

<p>
<label for="searchType">Type de recherche:</label>
<select name="searchType" id="searchType">
<option value="1">Texte brut</option>
<option value="2">Expression régulière</option>
</select>
</p>

<br />

<p>
<label for="searchDirection">Sens:</label>
<select name="searchDirection" id="searchDirection">
<option value="1">Tous</option>
<option value="2">Vers le bas</option>
<option value="3">Vers le haut</option>
</select>
</p>

<br />

<p>
<label for="searchZone">Zonne de recherche:</label>
<select name="searchZone" id="searchZone">
<option value="1">le document courant</option>
<option value="2">la classe courante</option>
<option value="3">la fonction courante</option>
<option value="4">le texte sélectionné</option>
<option value="5">tous les onglets ouverts</option>
</select>
</p>

<br />

<p>
Respecter la cass
<input type="checkbox" name="respectCase" id="respectCase" />
<label for="respectCase">Respecter la cass</label>
</p>

<br />

<p>
Mot entier uniquement
<input type="checkbox" name="allWordOnly" id="allWordOnly" />
<label for="allWordOnly">Mot entier uniquement</label>
</p>

<br />

<p>
<input type="button" value="Remplacer tout" onClick="form1_validate()" />
<input type="button" value="Annuler" onClick="form1_cancel()" />
</p>

</form>

	</BODY>
</HTML>















